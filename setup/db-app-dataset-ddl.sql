CREATE TABLE MLAPP.DATASETS (
    ID VARCHAR2(64) PRIMARY KEY,
    NAME VARCHAR2(64) NOT NULL unique,
    TYPE VARCHAR2(64) NOT NULL,
    LOCATION VARCHAR2(512) NOT NULL,
    ADDED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    DELETED TIMESTAMP,
    IS_STRUCTURED NUMBER CHECK (IS_STRUCTURED IN (0, 1)),
    IS_TABELARIC NUMBER CHECK (IS_TABELARIC IN (0, 1)),
    HEADERS_IN_SOURCE NUMBER CHECK (HEADERS_IN_SOURCE IN (0, 1)),
    DESCRIPTION VARCHAR2(1024),
    ROW_MOD_DTTM TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	IS_ACTIVE NUMBER
);

CREATE OR REPLACE TRIGGER trg_generate_dataset_id
BEFORE INSERT ON MLAPP.DATASETS
FOR EACH ROW
DECLARE
    v_hash VARCHAR2(64);
BEGIN
    IF :NEW.ID IS NULL THEN
        EXECUTE IMMEDIATE
            'SELECT UPPER(SUBSTR(STANDARD_HASH(:1, ''SHA256''), 1, 64)) FROM DUAL'
            INTO v_hash
            USING :NEW.NAME;
        :NEW.ID := v_hash;
    END IF;
END;
/
CREATE OR REPLACE TRIGGER MLAPP.trg_update_row_mod_dtt
BEFORE UPDATE ON MLAPP.DATASETS
FOR EACH ROW
BEGIN
    :NEW.ROW_MOD_DTTM := CURRENT_TIMESTAMP;
END;
/